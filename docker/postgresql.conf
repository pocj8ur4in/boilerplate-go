#------------------------------------------------------------------------------
# CONNECTION SETTINGS
#------------------------------------------------------------------------------

# Listen on all addresses
listen_addresses = '*'

# Maximum number of concurrent connections (one process uses 2-4MB memory)
max_connections = 100

#------------------------------------------------------------------------------
# RESOURCE USAGE
#------------------------------------------------------------------------------

# Shared memory for caching database pages (recommended: 25% of RAM)
shared_buffers = 256MB

# Memory for sorting and hash operations per query (max_connections * work_mem should be < RAM)
work_mem = 16MB

# Memory for maintenance operations like VACUUM, CREATE INDEX (recommended: 10% of RAM)
maintenance_work_mem = 128MB

# Hint to planner about available OS cache (recommended: 50-75% of total RAM)
effective_cache_size = 1GB

#------------------------------------------------------------------------------
# WRITE AHEAD LOG (WAL)
#------------------------------------------------------------------------------

# Buffer size for write ahead log (recommended: 16MB)
wal_buffers = 16MB

# Checkpoint completion target (0.5-0.9, higher = smoother I/O)
checkpoint_completion_target = 0.9

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

# Default statistics target for ANALYZE (10-1000, higher = better plans but slower ANALYZE)
default_statistics_target = 100

# Cost of random page access (lower for SSD, 1.1 for Docker volumes)
random_page_cost = 1.1

# Number of concurrent disk I/O operations (for SSD, set higher)
effective_io_concurrency = 200

#------------------------------------------------------------------------------
# PARALLEL QUERY
#------------------------------------------------------------------------------

# Maximum number of background worker processes
max_worker_processes = 4

# Maximum number of parallel workers per gather operation
max_parallel_workers_per_gather = 2

# Maximum number of parallel workers
max_parallel_workers = 4

# Maximum number of parallel workers for maintenance operations
max_parallel_maintenance_workers = 2

#------------------------------------------------------------------------------
# LOGGING AND MONITORING
#------------------------------------------------------------------------------

# Log queries taking longer than this (milliseconds, -1 = disabled)
log_min_duration_statement = 1000

# Log line prefix (timestamp, process ID, line number, user, database, etc.)
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Log checkpoints (useful for monitoring)
log_checkpoints = on

# Log lock waits (useful for debugging deadlocks)
log_lock_waits = on

#------------------------------------------------------------------------------
# STATISTICS
#------------------------------------------------------------------------------

# Track I/O timing statistics (adds overhead but useful for analysis)
track_io_timing = on

# Track function call counts and execution time
track_functions = all

# Load pg_stat_statements extension at server start
shared_preload_libraries = 'pg_stat_statements'

# Track all statements (all/top/none)
pg_stat_statements.track = all

# Maximum number of statements tracked
pg_stat_statements.max = 10000
